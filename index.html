<!DOCTYPE html>

<head>
   <meta charset="UTF-8">
   <title>Visualização Ocorrências Policiais</title>
   <script src="libs/d3.min.js"></script>
   <!--Include Leaflet CSS-->
   <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
      integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
      crossorigin="" />
   <style>
      #mapid {
         height: 90%;
         position: absolute;
         width: 80%;
      }

      #menu {
         float: right;
      }

      .label_menu {
         text-align: center;
      }
   </style>
</head>
<div id="container">

   <body>
      <h2>Roubos de smartphones</h2>
      <script>
         //Requesting data from the server

         function loadData() {
            var xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function () {
               if (this.readyState == 4 && this.status == 200) {
                  /* document.getElementById("demo").innerHTML =
                      this.responseText;*/
                  var arrMarker = JSON.parse(this.responseText);
                  addMarker(arrMarker);
               }
            };
            var month = document.getElementById('ini_month').value
            var brand = document.getElementById('brand').value
            xhttp.open("GET", "http://api.crimevis.work/getoccur?ini_month=" + month + "&brand=" + brand + "", true);
            xhttp.send();
         }

         //Adding markers
         function addMarker(insMarker) {
            var i;
            //mymap.removeLayer(marker);
            for (i = 0; i < insMarker.length; i++) {
               var lat = insMarker[i].latitude;
               var lng = insMarker[i].longitude;
               var marca_celular = insMarker[i].marca_celular;
               var rubrica = insMarker[i].rubrica;
               if (marca_celular == "APPLE"){
                  var marker = L.circleMarker([lat, lng], {color: '#ff0000'}).addTo(mymap);
                  marker.bindPopup("<b>Marca Celular: " + marca_celular + "</b><br>" + rubrica + "").openPopup();
               }else{
                  var marker = L.circleMarker([lat, lng], {color: '#006600'}).addTo(mymap);
                  marker.bindPopup("<b>Marca Celular: " + marca_celular + "</b><br>" + rubrica + "").openPopup();
               }
            }
            /*var lat = insMarker[0].latitude;
            var lng = insMarker[0].longitude;
            var marker = L.marker([lat, lng]).addTo(mymap);
            */
         }
      </script>
      <!--<script type="text/javascript">
         d3.select("body").append("p").text("Hello World");
      </script>-->
      <!-- Make sure you put this AFTER Leaflet's CSS -->
      <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
         integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
         crossorigin=""></script>
      <div id="menu">
         <h4 class="label_menu">Menu</h4>
         <form action="#">
            <fieldset>
               <label for="mes_inicio">Mês :</label>
               <select name="ini_month" id="ini_month">
                  <option value="Julho">Julho</option>
                  <option value="Agosto">Agosto</option>
                  <option value="Setembro">Setembro</option>
                  <option value="Outubro">Outubro</option>
                  <option value="Novembro">Novembro</option>
                  <option value="Dezembro">Dezembro</option>
               </select>
            </fieldset>
            <fieldset>
               <label for="brand">Modelo:</label>
               <select name="brand" id="brand">
                  <option value="APPLE">APPLE</option>
                  <option value="ANDROID">ANDROID</option>
                  <option value="AMBOS">AMBOS</option>
               </select>
               <input type="button" value="Selecionar" onclick="loadData()">
         </form>
      </div>
      <div id="mapid"></div>
      <script>
         var mymap = L.map('mapid').setView([-23.5797, -46.6236], 12);
         L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
         }).addTo(mymap);
      </script>
      <!--<script>
         //addMarker()
      </script>-->
</div>
</body>

</html>